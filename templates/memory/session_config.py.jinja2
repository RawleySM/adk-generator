"""Session and memory configuration for {{ project_name }}."""

{% if session_type == "in_memory" %}
from google.adk.sessions import InMemorySessionService
{% elif session_type == "database" %}
from google.adk.sessions import DatabaseSessionService
{% elif session_type == "vertexai" %}
from google.adk.sessions import VertexAISessionService
{% endif %}
from google.adk.runners import Runner
{% if enable_compaction %}
from google.adk.apps import EventsCompactionConfig, LlmEventsSummarizer
{% endif %}
{% if enable_context_cache %}
from google.adk.agents import ContextCacheConfig
{% endif %}

from .app import app


# Configure session service
{% if session_type == "in_memory" %}
session_service = InMemorySessionService()
{% elif session_type == "database" %}
session_service = DatabaseSessionService(
    connection_string="{{ database_url }}"
)
{% elif session_type == "vertexai" %}
session_service = VertexAISessionService(
    project_id="{{ gcp_project_id }}",
    location="{{ gcp_location }}"
)
{% endif %}

{% if enable_compaction %}
# Configure event compaction for long conversations
app.events_compaction_config = EventsCompactionConfig(
    summarizer=LlmEventsSummarizer(model="{{ model }}"),
    compaction_interval={{ compaction_interval }},
    overlap_size={{ overlap_size }}
)
{% endif %}

{% if enable_context_cache %}
# Configure context caching for large prompts
app.context_cache_config = ContextCacheConfig(
    enabled=True,
    ttl_seconds={{ cache_ttl }}
)
{% endif %}

# Create runner
runner = Runner(
    agent=app.root_agent,
    app_name="{{ project_name }}",
    session_service=session_service
)


def run_agent(user_input: str, session_id: str = None) -> str:
    """Run the agent with the given input.
    
    Args:
        user_input: The user's query or command
        session_id: Optional session ID for conversation continuity
        
    Returns:
        The agent's response
    """
    result = runner.run(user_input, session_id=session_id)
    return result
